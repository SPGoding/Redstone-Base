# 红石前置原版模组

该模组含有大量红石相关的函数，如果想要为你模组的自定义方块等增加红石特性，不如来使用这个模组！

# 安装

1. 安装前置模组[【UIN】——标签分类](https://www.mcbbs.net/thread-775667-1-1.html)。
2. 下载该模组，放置到存档的 `datapacks` 目录下。  
    [attach]1404541[/attach]

# 注意

1. 陷阱箱（`minecraft:trapped_chest`）不被认为是红石电源元件，因为无法检测。
2. 本模组为了思路方便，采用了较为诡异的强充能定义。不仅物理学不透明方块可被强充能，被按下的按钮、拉杆、压力板等电源元件也被认为是被强充能的方块。唯一在开启状态下不强充能自身的电源元件是红石火把。
3. 使用本前置模组所能添加的最多也就是机械元件。电源元件、传输元件等没有通用的与原版红石元件交互的方式，无法集成到本前置模组当中，如有需要还需各制作者自行实现。
    - 该模组初版的命令是能够让制作者自行定义电源元件、传输元件的，并且这些自定义元件能够与其他自定义元件正常交互，但是无法做到与原版的红石系统交互，相当于是实现了红石系统的一个超集，意义不大。相关命令已经移除。
    - 主要思路是给予 marker 各种标签，通过标签来表示该自定义元件能够输出/输入能量的方向等。

# 快速上手

1. 在某个方块的位置执行 `function rsbase:is_receiving_energy`（该函数最糟情况下会执行 814 条命令并返回 `0`，最佳情况下会执行 15 条命令。执行其间没有对 NBT 进行操作，没有生成任何临时实体，性能能看）。
2. 检测返回的 `result rsbase` 分数，如果为 `1` 则表明执行位置接受到了红石信号。可以让你的自定义机械对此做出反应，如停止运作等。

# 全部函数

## `is_powering_weakly`

检测执行位置的方块是否正在向指定方向进行**弱充能**。该目录下的函数只检测是否正在进行弱充能，不检测目标方块是否真的能被弱充能（即不检测目标方块是否是物理学不透明方块）。

### `neg_x` / `pos_x` / `neg_z` / `pos_z`

检测对应方向。如，`neg_x` 表示 X 轴负方向，即西方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 能量不为 0 的点状红石线
- 能量不为 0 的指向该方向的红石线

> 有关红石线的指向是通过方块状态判断的。如，指向西方的红石线，其方块状态中 `west`、`north`、`south` 为 `none`，`east` 为 `side` 或 `up`。
>
> 这种判断方式使得在两个红石线之间的红石线不会被判定为指向任何方向，它只会被判定为正在向下方进行弱充能。

### `neg_y`

检测 Y 轴负方向，即下方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 能量不为 0 的红石线

### `pos_y`

检测 Y 轴正方向，即上方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 不可能的，哪来的方块往上面弱充能

### `origin`

检测当前坐标，即自身。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 不可能的，哪来的方块把自己弱充能

## `is_powering_strongly`

检测执行位置的方块是否正在向指定方向进行**强充能**。该目录下的函数只检测是否正在进行强充能，不检测目标方块是否真的能被强充能（即不检测目标方块是否是物理学不透明方块）。

### `neg_x` / `pos_x` / `neg_z` / `pos_z`

检测对应方向。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 已激活的输出端指向该方向的红石中继器或红石比较器
- 已开启的输出端指向该方向的侦测器
- 被按下的附着在该方向方块上的按钮
- 被拉下的附着在该方向方块上的拉杆
- 被触发的附着在该方向方块上的拌线钩

> 红石中继器、红石比较器、侦测器、按钮、拉杆和拌线钩的 `facing` 方块状态与输出端的指向反向。

### `neg_y`

检测 Y 轴负方向，即下方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 正在供电的探测铁轨
- 正在供电的讲台
- 被踩下的压力板
- 已开启的输出端指向下方的侦测器
- 被按下的附着在地面上的按钮
- 被拉下的附着在地面上的拉杆

### `pos_y`

检测 Y 轴正方向，即上方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 亮着的红石火把
- 亮着的墙上的红石火把
- 已开启的输出端指向上方的侦测器
- 被按下的附着在天花板上的按钮
- 被拉下的附着在天花板上的拉杆

### `origin`

检测当前坐标，即自身。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 红石块
- 被按下的按钮
- 被拉下的拉杆
- 能量不为 0 的阳光探测器
- 正在供电的探测铁轨
- 正在供电的讲台
- 被踩下的压力板
- 被触发的拌线钩

## `can_be_powered`

检测执行位置的方块**是否可被充能**。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 物理学不透明方块
- 双层台阶

## `is_powered_strongly`

检测执行位置的方块**是否正在被强充能**。

- 或
    - 且
        - 或
            - 分别在六个方向上执行相应的 `rsbase:is_powering_strongly/DIR_A` 函数。
        - `can_be_powered`
    - `rsbase:is_powering_strongly/origin`

> 本模组中大量用到了类似于短路逻辑运算符的操作。
>
> 以「或」逻辑为例：  
> 假设有两个函数，`A` 与 `B`，这两个函数被执行后都会操作 `result rsbase` 分数将其作为返回值，取值为 `0` 或 `1`。  
> 现在需要在函数 `X` 内执行这两个函数，并且返回值中至少一个返回 `1` 时，设置 `1` 到 `result rsbase` 分数。  
> 只需先执行 `function A`，并在执行后 `result rsbase` 分数仍为 `0` 时再执行 `function B`。这样可以使 `A` 为 `1` 时不运算 `B`，减少命令运行数。
>
> 「且」与上述步骤类似，只不过最后是检测 `result rsbase` 分数为 `1` 时再执行 `function B`。

## `is_powered_weakly`

检测执行位置的方块**是否正在被弱充能**。

- 逻辑与 `is_powered_strongly` 类似。

## `is_powered`

检测当前位置的方块**是否正在被充能**。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- `is_powered_weakly`
- `is_powered_strongly`

## `is_providing_energy`

检测当前位置的方块是否正在向指定方向的方块**提供能量**。「提供能量」不等于「充能」。

### `neg_x` / `pos_x` / `neg_z` / `pos_z`

检测对应方向。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 亮着的红石火把
- 亮着的没有附着在该方向的墙上的墙上的红石火把
- `is_powering_weakly/DIR_A`
- `is_powering_strongly/DIR_A`
- `is_powered`

### `neg_y`

检测 Y 轴负方向，即下方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 亮着的墙上的红石火把
- `is_powering_weakly/neg_y`
- `is_powering_strongly/neg_y`
- `is_powered`

### `pos_y`

检测 Y 轴正方向，即上方。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- `is_powering_weakly/pos_y`
- `is_powering_strongly/pos_y`
- `is_powered`

### `origin`

检测当前坐标，即自身。

当执行位置的方块满足以下任意条件时函数返回 `1`，否则返回 `0`：
- 亮着的红石火把
- 亮着的墙上的红石火把
- `is_powered`

## `is_receiving_energy`

检测当前位置的方块是否正在（从指定方向的方块）**接受能量**。「接受能量」不等于「被充能」。

### `neg_x` / `pos_x` / `neg_y` / `pos_y` / `neg_z` / `pos_z` / `origin`

检测对应方向。可以用于实现类似于红石中继器一类的只能从指定方向输入信号的元件。

在对应位置上执行相应的 `is_providing_energy/DIR_A` 函数。
